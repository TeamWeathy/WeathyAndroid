# WeathyAndroid
<!-- ALL-CONTRIBUTORS-BADGE:START - Do not remove or modify this section -->
[![All Contributors](https://img.shields.io/badge/all_contributors-3-blue.svg?style=flat-square)](#contributors-)
<!-- ALL-CONTRIBUTORS-BADGE:END -->

## ëª©ì°¨

- [ê¸°ì—¬ìë“¤](#ê¸°ì—¬ìë“¤-)
- [ê°ì ë§¡ì€ ë¶€ë¶„ ë° ì—­í•  ì‘ì„±](#ê°ì-ë§¡ì€-ë¶€ë¶„-ë°-ì—­í• -ì‘ì„±)
- [ì•ˆë“œë¡œì´ë“œ íˆ´ ì„¸íŒ…](#ì•ˆë“œë¡œì´ë“œ-íˆ´-ì„¸íŒ…)
  - [Gradle ì„¤ì •](#gradle-ì„¤ì •)
  - [ì½”ë“œ ì»¨ë²¤ì…˜](#ì½”ë“œ-ì»¨ë²¤ì…˜)
  - [ê¹ƒ ì‚¬ìš©ì „ëµ](#git-ì‚¬ìš©-ì „ëµ)
  - [ê¹ƒí—ˆë¸Œ ì•¡ì…˜, ìŠ¬ë™ë´‡](#github-action--slack-bot)
- [ì‚¬ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ & ëª©ì ](#ì‚¬ìš©-ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€-ëª©ì )
- [ì‚¬ìš©í•œ ê¸°ìˆ  ìŠ¤íƒ](#ì‚¬ìš©í•œ-ê¸°ìˆ -ìŠ¤íƒ)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°íŒ¨í‚¤ì§€-ë¶„ë¥˜-ì´ë¯¸ì§€)
- [êµ¬í˜„ í™”ë©´](#êµ¬í˜„-í™”ë©´)
- [íšŒì˜ë¡](#íšŒì˜ë¡-ì£¼ì†Œ)
- [í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„ ë°©ë²• ì½”ë“œ](#í•µì‹¬-ê¸°ëŠ¥-êµ¬í˜„-ë°©ë²•-ì½”ë“œ)
- [íŠ¹ìˆ˜ ë ˆì´ì•„ì›ƒ](#íŠ¹ìˆ˜-ë ˆì´ì•„ì›ƒ)
- [ë„í˜• ë° ìƒíƒœë³€í™˜](#ë„í˜•-ë°-ìƒíƒœë³€í™˜)

## ê¸°ì—¬ìë“¤ âœ¨

<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->
<!-- prettier-ignore-start -->
<!-- markdownlint-disable -->
<table>
  <tr>
    <td align="center"><a href="https://github.com/dingding-21"><img src="https://avatars3.githubusercontent.com/u/63945197?v=4" width="100px;" alt=""/><br /><sub><b>dingding-21</b></sub></a><br /><a href="https://github.com/TeamWeathy/WeathyAndroid/commits?author=dingding-21" title="Code">ğŸ’»</a></td>
    <td align="center"><a href="https://github.com/kmebin"><img src="https://avatars3.githubusercontent.com/u/72112845?v=4" width="100px;" alt=""/><br /><sub><b>kmebin</b></sub></a><br /><a href="https://github.com/TeamWeathy/WeathyAndroid/commits?author=kmebin" title="Code">ğŸ’»</a></td>
    <td align="center"><a href="https://www.mjstudio.net/"><img src="https://avatars0.githubusercontent.com/u/33388801?v=4" width="100px;" alt=""/><br /><sub><b>MJ Studio</b></sub></a><br /><a href="https://github.com/TeamWeathy/WeathyAndroid/commits?author=mym0404" title="Code">ğŸ’»</a></td>
  </tr>
</table>

<!-- markdownlint-enable -->
<!-- prettier-ignore-end -->
<!-- ALL-CONTRIBUTORS-LIST:END -->


## ê°ì ë§¡ì€ ë¶€ë¶„ ë° ì—­í•  ì‘ì„±

ëª…ì£¼: ìŠ¤í”Œë˜ì‹œ í™”ë©´, ì˜¨ë³´ë”© í™”ë©´, ë‹‰ë„¤ì„ ì„¤ì • í™”ë©´, í™ˆ í™”ë©´, ìº˜ë¦°ë” í™”ë©´, ë‚ ì”¨ ê²€ìƒ‰ í™”ë©´
í¬ë¹ˆ: ë‚ ì”¨ ì¶”ê°€ ì‹œì‘ í™”ë©´, ë‚ ì”¨ ì¶”ê°€ ì˜· ì„ íƒ í™”ë©´, ë‚ ì”¨ ì¶”ê°€ ì˜· ì‚­ì œ í™”ë©´, ì»¤ìŠ¤í…€ Dialogë“¤, ë‚ ì”¨ ì¶”ê°€ ë‚ ì”¨ ì„ íƒ í™”ë©´, ë‚ ì”¨ ì¶”ê°€ í”¼ë“œë°± ì‘ì„± í™”ë©´
í˜„ì§€: í™ˆ í™”ë©´, ì„¤ì • í™”ë©´, ë‹‰ë„¤ì„ ë³€ê²½ í™”ë©´, ë¬¸ì˜í•˜ê¸° í™”ë©´, ê°œë°œì ì •ë³´ í™”ë©´


- ìŠ¤í”Œë˜ì‹œ: ëª…ì£¼

<img src="image/splash.gif" width="300px"/>

- ì˜¨ë³´ë”©: ëª…ì£¼

<img src="image/landing.gif" width="300px"/>

- ë‹‰ë„¤ì„ ì„¤ì •: ëª…ì£¼

<img src="image/nicknameset.gif" width="300px"/>

- í™ˆ: í˜„ì§€, ëª…ì£¼
 
<img src="image/home.gif" width="300px"/>

- ê²€ìƒ‰: ëª…ì£¼

<img src="image/search.gif" width="300px"/>

- ìº˜ë¦°ë”: ëª…ì£¼

<img src="image/calendar.gif" width="300px"/>

- ë‚ ì”¨ ì¶”ê°€ ì‹œì‘: í¬ë¹ˆ

<img src="image/record_start.gif" width="300px"/>

- ë‚ ì”¨ ì¶”ê°€ ì˜· ì„ íƒ

<img src="image/record_select.gif" width="300px"/>

- ë‚ ì”¨ ì¶”ê°€ ì˜· ì‚­ì œ

<img src="image/record_delete.gif" width="300px"/>

- ë‚ ì”¨ ì¶”ê°€ ë‚ ì”¨ ì„ íƒ

<img src="image/record_rating.gif" width="300px"/>

- ë‚ ì”¨ ì¶”ê°€ í”¼ë“œë°± ì‘ì„±

<img src="image/record_feedback.gif" width="300px"/>

- ì„¤ì •: í˜„ì§€

<img src="image/setting.gif" width="300px"/>

- ë‹‰ë„¤ì„ ë³€ê²½: í˜„ì§€

<img src="image/nickname_change.gif" width="300px"/>

- íŒ€ ì •ë³´: í˜„ì§€

<img src="image/developers.gif" width="300px"/>

## ì•ˆë“œë¡œì´ë“œ íˆ´ ì„¸íŒ…

### Gradle ì„¤ì •

- ì»´íŒŒì¼ SDK ë²„ì „: `30`
- ë¹Œë“œíˆ´ ë²„ì „: `29.0.3`
- ìµœì†Œ SDK ë²„ì „: `23`
- íƒ€ê²Ÿ SDK ë²„ì „: `30`
- ë¦´ë¦¬ì¦ˆ ë¹Œë“œ ì„¤ì •
  - ì•ˆì“°ëŠ” ë¦¬ì†ŒìŠ¤ ì œê±°: `true`
  - ì½”ë“œ ë‚œë…í™” ë° ìµœì í™”: `true`
```groovy
release {
    signingConfig signingConfigs.release
    shrinkResources true
    minifyEnabled true
    proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
}
```
- ì»´íŒŒì¼ ì˜µì…˜
  - ìë°” í˜¸í™˜ì„± ë²„ì „: `1.8`
  - ì½”ì–´ë¼ì´ë¸ŒëŸ¬ë¦¬ desugar: `true`
```groovy
compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
    coreLibraryDesugaringEnabled true
}
```
- ì½”í‹€ë¦° ì˜µì…˜
  - JVM íƒ€ê²Ÿ ë²„ì „: `1.8`
```groovy
kotlinOptions {
    jvmTarget = '1.8'
}
```
- ë¹Œë“œ ê¸°ëŠ¥ ì¶”ê°€
  - ë°ì´í„° ë°”ì¸ë”©: `true`
  - ë·° ë°”ì¸ë”©: `true`
```groovy
buildFeatures {
    dataBinding true
    viewBinding true
}
```
- í…ŒìŠ¤íŠ¸ ì˜µì…˜
  - ìœ ë‹›í…ŒìŠ¤íŠ¸ ê¸°ë³¸ê°’ ë°˜í™˜
  - ìœ ë‹›í…ŒìŠ¤íŠ¸ ì•ˆë“œë¡œì´ë“œ ë¦¬ì†ŒìŠ¤ í¬í•¨(Reboletrics)
```groovy
testOptions {
    unitTests.returnDefaultValues = true
    unitTests {
        includeAndroidResources = true
    }
}
```
- ë¦°íŠ¸ ì˜µì…˜
  - abortOnError ë¹„í™œì„±í™”
```groovy
lintOptions {
    abortOnError false
}
```

### ì½”ë“œ ì»¨ë²¤ì…˜

- ì•ˆë“œë¡œì´ë“œ ìŠ¤íŠœë””ì˜¤ [Preferences] - [Editor] - [Code Style] - [Kotlin] ì—ì„œ Kotlin style guide ë¥¼ ì ìš©í•˜ê³  `Reformat with code` ë¡œ ì½”ë“œ í¬ë§¤íŒ…

- ì¸í„°ë„·ì— ì½”í‹€ë¦°ì„ ì‚¬ìš©í•˜ëŠ” [ìŠ¤íƒ€ì¼ ê°€ì´ë“œë¥¼ ì˜ ì •ë¦¬í•´ë‘” ê¸€](https://medium.com/mj-studio/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%9D%B4%EB%A0%87%EA%B2%8C-%EC%9E%91%EC%84%B1%ED%95%98%EC%8B%9C%EB%A9%B4-%EB%90%A9%EB%8B%88%EB%8B%A4-94871a1fa646)ì„ ìš°ì—°íˆ ë°œê²¬í•´ ì´ ê¸€ì—ì„œ ì—¬ëŸ¬ê°€ì§€ë¥¼ ë°°ì›Œì„œ ì‚¬ìš©

### git ì‚¬ìš© ì „ëµ

![](image/git.jpg)

#### main(default) ë¸Œëœì¹˜

- `main` ë¸Œëœì¹˜ê°€ default ë¸Œëœì¹˜
- `main` ì—ì˜ ì§ì ‘ì ì¸ `push`ë¥¼ ì§€ì–‘
- force push ëŠ” Github branch protection ìœ¼ë¡œ ë§‰ì•„ë‘ 

#### ê¸°ëŠ¥(feature) ì¶”ê°€ ë°©ì‹

1. ê¸°ëŠ¥ë³„ë¡œ ë¸Œëœì¹˜ë¥¼ ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ìƒì„±
2. ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ê·¸ ë¸Œëœì¹˜ë¥¼ ì›ê²© ì €ì¥ì†Œ(`origin`) ìœ¼ë¡œ `push`
3. Pull Request ìƒì„± ë° íŒ€ì›ì—ê²Œ ê³µìœ 
4. Pull Request ë³‘í•©í•  ë•Œ `Create merge commit` ì˜µì…˜ì„ ì‚¬ìš©
5. Pull Request ê°€ ë³‘í•©ë˜ë©´(mainì—) íŒ€ì›ë“¤ì—ê²Œ ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ `main` ì— ì¶”ê°€ë˜ì—ˆìœ¼ë‹ˆ ë¡œì»¬ ì €ì¥ì†Œì—ì„œ `pull` ì„ í•´ì„œ ë™ê¸°í™” í•˜ë¼ê³  ì•Œë ¤ì¤Œ

### Github action & Slack Bot

![](image/slack.jpg)

- ê¹ƒí—ˆë¸Œ ì•¡ì…˜ìœ¼ë¡œ `push`í•  ë•Œë§ˆë‹¤, ìë™ìœ¼ë¡œ ë¦´ë¦¬ì¦ˆ ë¹Œë“œê°€ ë˜ì–´ íŒ€ì˜ ìŠ¬ë™ ì±„ë„ì— apk íŒŒì¼ì„ ì „ë‹¬í•´ì¤Œ

```yml
name: Android Build
on: [push]
defaults:
  run:
    shell: bash
    working-directory: .

jobs:
  build:
    runs-on: ubuntu-latest
    name: InstrumentationTest + Build
    if: "!contains(toJSON(github.event.commits.*.message), '[skip action]') && !startsWith(github.ref, 'refs/tags/')"
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Gradle cache
        uses: actions/cache@v2
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      #      - uses: actions/setup-java@v1
      #        with:
      #          java-version: '1.8'

      #      - name: Android Emulator Runner, Test
      #        uses: ReactiveCircus/android-emulator-runner@v2.14.2
      #        with:
      #          api-level: 29
      #          script: ./gradlew connectedCheck

      - name: Build Release
        if: ${{ contains(github.ref, 'main') }}
        run: ./gradlew assembleRelease
      - name: Build Debug
        if: ${{ !contains(github.ref, 'main') }}
        run: ./gradlew assembleDebug

      - name: Archive artifacts
        uses: actions/upload-artifact@v2
        with:
          path: app/build/outputs
      - name: Update Release apk name
        if: ${{ success() && contains(github.ref, 'main') }}
        run: |
          mv app/build/outputs/apk/release/app-release.apk ì›¨ë””-ë¦´ë¦¬ì¦ˆ.apk
          echo 'apk=ì›¨ë””-ë¦´ë¦¬ì¦ˆ.apk' >> $GITHUB_ENV
      - name: Upload APK
        if: ${{ success() && contains(github.ref, 'main') }}
        run: |
          curl -X POST \
          -F file=@$apk \
          -F channels=${{secrets.SLACK_CHANNEL_ID}} \
          -H "Authorization: Bearer ${{secrets.SLACK_BOT_API_TOKEN}}" \
          https://slack.com/api/files.upload
      - name: On success, Notify with Slack
        if: ${{ success() && contains(github.ref, 'main') }}
        uses: rtCamp/action-slack-notify@master
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_ANDROID }}
          SLACK_TITLE: 'ì•ˆë“œë¡œì´ë“œ ë¦´ë¦¬ì¦ˆ ë¹Œë“œ ì„±ê³µ âœ…'
          MSG_MINIMAL: true
          SLACK_MESSAGE: 'apkê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤'
      - name: On fail, Notify with Slack
        if: ${{ failure() }}
        uses: rtCamp/action-slack-notify@master
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_ANDROID }}
          SLACK_TITLE: 'ì•ˆë“œë¡œì´ë“œ ë¹Œë“œ ì‹¤íŒ¨ âŒ'
          MSG_MINIMAL: false
          SLACK_MESSAGE: 'ì—ëŸ¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”'
```

## ì‚¬ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ëª©ì 

- Glide: url í˜•íƒœì˜ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë°›ì•„ `ImageView`ì— í‘œì‹œí•´ì£¼ëŠ” ìš©ë„. ìºì‹œë„ ìë™ìœ¼ë¡œ í•´ì¤Œ
- Retrofit: `OkHttp3`ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ Rest APIë¥¼ ì‚¬ìš©í•˜ê²Œ í•´ì¤„ ìˆ˜ ìˆëŠ” ì–´ë…¸í…Œì´ì…˜ í”„ë¡œì„¸ì„œë¥¼ ì´ìš©í•œ ìë°” ë¼ì´ë¸ŒëŸ¬ë¦¬. ì„œë²„ì™€ì˜ í†µì‹ ì— ì‚¬ìš©
- Material Design Component: êµ¬ê¸€ì´ ê°œë°œí•œ ë§¤í„°ë¦¬ì–¼ ë””ìì¸ì„ ì•ˆë“œë¡œì´ë“œì—ì„œ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” êµ¬í˜„ì²´ë“¤ì„ ì œê³µí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬. UIì— ì ìš©
- SwipeRefreshLayout: ë‹¹ê²¨ì„œ ë¦¬í”„ë ˆì‹œ í•  ìˆ˜ ìˆëŠ” ë ˆì´ì•„ì›ƒì„ ì œê³µ.
- AAC Lifecycle: LiveData, Lifecycle, ViewModel ë“± ì•ˆë“œë¡œì´ë“œ ìƒëª…ì£¼ê¸°ì™€ ì—°ë™ëœ ì»´í¬ë„ŒíŠ¸ë“¤ê³¼ í´ë˜ìŠ¤ë“¤ì„ ì œê³µ
- Kotlin Standard Library: ì½”í‹€ë¦°ì˜ í™•ì¥ í´ë˜ìŠ¤ë“¤ì„ ì œê³µí•´ì£¼ê³  ì»¬ë ‰ì…˜ì„ ì†ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ
- Jetpack Activity: ì•ˆë“œë¡œì´ë“œì˜ `Activity`ë¥¼ ê³„ì† ë°œì „ì‹œì¼œ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ
- Jetpack Fragment: ì•ˆë“œë¡œì´ë“œì˜ `Fragment`ë¥¼ ê³„ì† ë°œì „ì‹œì¼œ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ
- Jetpack Core KTX
- ConstraintLayout: `ConstraintLayout`ì„ ì‚¬ìš©í•˜ì—¬ ë·°ë“¤ì„ ë ˆì´ì•„ì›ƒì— ì†ì‰½ê²Œ ë°°ì¹˜í•´ì£¼ê²Œ í•´ì¤Œ. ê·¸ë¦¬ê³  `MotionLayout`ë„ ì œê³µ
- Dexter: ê¶Œí•œ í—ˆìš©ì„ ì‰½ê²Œ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬. ìœ„ì¹˜ ê¶Œí•œ í—ˆìš©ì— ì‚¬ìš©
- Google Mobile Service Location: í˜„ì¬ ìœ„ì¹˜ë¥¼ ë°›ì•„ì˜¤ê±°ë‚˜ ì§€ì˜¤ì½”ë”© í•˜ëŠ”ë° ì‚¬ìš©
- Dynamic animation: Spring ë¬¼ë¦¬ë¥¼ ì´ìš©í•œ ì• ë‹ˆë©”ì´ì…˜ì„ êµ¬í˜„í•˜ëŠ” ë° ì‚¬ìš©
- Desugar JDK Library: `java.time` íŒ¨í‚¤ì§€ ìœ í‹¸ë¦¬í‹°ë“¤ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ desugaringì— ì‚¬ìš©
- Flipper: ë””ë²„ê¹…ì— ì‚¬ìš©
- Hilt: ì˜ì¡´ì„± ì£¼ì…ì— ì‚¬ìš©
- Room: ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤, ìµœê·¼ ê²€ìƒ‰ ìœ„ì¹˜ ì €ì¥ì— ì‚¬ìš©
- LoremIpsum: Mock ë°ì´í„° ìƒì„±ì— ì‚¬ìš©
- Lottie: ìŠ¤í”Œë˜ì‹œ ì• ë‹ˆë©”ì´ì…˜ì— ì‚¬ìš©
- [Snowfall](https://github.com/JetradarMobile/android-snowfall) ì½”ë“œ ê°€ì ¸ì™€ì„œ ìˆ˜ì •í•´ì„œ ì‚¬ìš©: ëˆˆ, ë¹„ ë‚´ë¦¬ëŠ” ì• ë‹ˆë©”ì´ì…˜


## ì‚¬ìš©í•œ ê¸°ìˆ  ìŠ¤íƒ

- AAC DataBinding, ViewModel
```kotlin
class MainActivity : AppCompatActivity() {
    private lateinit var binding: ActivityMainBinding
    private val viewModel by viewModels<MainViewModel>()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        binding = ActivityMainBinding.inflate(layoutInflater)
        binding.vm = viewModel
        binding.lifecycleOwner = this
        setContentView(binding.root)
        ...
    }
```
- ë¹„ë™ê¸° ì‘ì—… - Coroutine
```kotlin
override fun onAttachedToWindow() {
    super.onAttachedToWindow()
    initialJob = GlobalScope.launch(Dispatchers.Main) {
        ...
    }
}

override fun onDetachedFromWindow() {
    super.onDetachedFromWindow()
    initialJob.cancel()
}
```
- ë‚ ì§œ ì²˜ë¦¬ - `java.time.LocalDate`, `java.util.Calendar`
  - Java 8ì˜ íŒ¨í‚¤ì§€ì´ê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ë ¤ë©´ desugaringì„ í•´ì£¼ì–´ì•¼ í•¨
```kotlin
fun convertMonthlyIndexToDateToFirstDateOfMonthCalendar(index: Int): Pair<LocalDate, LocalDate> {
    val cur = LocalDate.now()

    val diffMonth = MonthlyAdapter.MAX_ITEM_COUNT - index - 1
    val monthSubtracted = cur.minusMonths(diffMonth.toLong())
    val firstDateOfMonth = monthSubtracted.withDayOfMonth(1)
    val startIdx = firstDateOfMonth.dayOfWeekIndex

    return firstDateOfMonth.minusDays(startIdx.toLong()) to firstDateOfMonth
}
```


## í”„ë¡œì íŠ¸ êµ¬ì¡°(íŒ¨í‚¤ì§€ ë¶„ë¥˜ ì´ë¯¸ì§€)

![](image/package.jpg)

## êµ¬í˜„ í™”ë©´

### TODO

## íšŒì˜ë¡ ì£¼ì†Œ

[íšŒì˜ë¡ ìœ„í‚¤ í™ˆ](https://github.com/TeamWeathy/WeathyAndroid/wiki)

## í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„ ë°©ë²• ì½”ë“œ

- í˜„ì¬ ìœ„ì¹˜ ë°›ì•„ì˜¤ê¸° (`LocationService`, `FusedLocationProviderClient`, `Geocoder`)
***LocationUtil.kt***
```kotlin
@SuppressLint("MissingPermission")
class LocationUtil @Inject constructor(app: Application, private val spUtil: SPUtil) : DefaultLifecycleObserver {
    private val locationManager = app.getSystemService(LocationManager::class.java)

    private val _lastLocation = MutableStateFlow<Location?>(null)
    val lastLocation: StateFlow<Location?> = _lastLocation

    private val _isOtherPlaceSelected: MutableStateFlow<Boolean> = MutableStateFlow(false)
    val isOtherPlaceSelected: StateFlow<Boolean> = _isOtherPlaceSelected

    val selectedWeatherLocation: MutableStateFlow<OverviewWeather?> = MutableStateFlow(null)

    private var isRegistered = false

    override fun onCreate(owner: LifecycleOwner) {
        registerLocationListener()

        _isOtherPlaceSelected.value = spUtil.isOtherPlaceSelected
    }

    override fun onDestroy(owner: LifecycleOwner) {
        unregisterLocationListener()
    }

    private val locationListener = object : LocationListener {
        override fun onLocationChanged(location: Location) {
            _lastLocation.value = location
        }

        override fun onStatusChanged(provider: String?, status: Int, extras: Bundle?) {
        }

        override fun onProviderEnabled(provider: String) {
        }

        override fun onProviderDisabled(provider: String) {
        }
    }

    fun registerLocationListener() {
        if (isRegistered) return

        debugE("registerLocationListener")
        try {
            _lastLocation.value = locationManager.getLastKnownLocation(LocationManager.GPS_PROVIDER)

            val enabledProviders = locationManager.allProviders.filter {
                locationManager.isProviderEnabled(it)
            }
            val provider =
                if (LocationManager.GPS_PROVIDER in enabledProviders) LocationManager.GPS_PROVIDER else enabledProviders.first()

            locationManager.requestLocationUpdates(provider, 1000, 1f, locationListener)
            isRegistered = true
        } catch (e: Throwable) {
            debugE(e)
        }
    }

    private fun unregisterLocationListener() {
        debugE("unregisterLocationListener")

        locationManager.removeUpdates(locationListener)
        isRegistered = false
    }

    fun selectPlace(weather: OverviewWeather) {
        spUtil.lastSelectedLocationCode = weather.region.code
        selectedWeatherLocation.value = weather
        spUtil.isOtherPlaceSelected = false
        _isOtherPlaceSelected.value = false
    }

    fun selectOtherPlace(weather: OverviewWeather) {
        spUtil.lastSelectedLocationCode = weather.region.code
        selectedWeatherLocation.value = weather
        spUtil.isOtherPlaceSelected = true
        _isOtherPlaceSelected.value = true
    }
}
```

- ì»¤ìŠ¤í…€ ë·°(`WeathyCardView`)
***WeathyCardView.kt***
```kotlin
class WeathyCardView @JvmOverloads constructor(context: Context, attrs: AttributeSet? = null) :
    FrameLayout(context, attrs) {
    private val defaultShadowColor = Color.BLACK

    var radius by OnChangeProp(35.dpFloat) {
        updateUI()
    }
    var shadowColor by OnChangeProp(defaultShadowColor) {
        updateUI()
    }
    var disableShadow by OnChangeProp(false) {
        updateUI()
    }
    var strokeColor by OnChangeProp(Color.TRANSPARENT) {
        updateUI()
    }
    var strokeWidth by OnChangeProp(0f) {
        updateUI()
    }
    var cardBackgroundColor by OnChangeProp(Color.WHITE) {
        updateUI()
    }

    init {
        if (attrs != null) {
            getStyleableAttrs(attrs)
        }
        elevation = if (disableShadow) 0f else px(8).toFloat()
        updateUI()
    }

    private fun getStyleableAttrs(attr: AttributeSet) {
        context.theme.obtainStyledAttributes(attr, R.styleable.WeathyCardView, 0, 0).use { arr ->
            radius = arr.getDimension(R.styleable.WeathyCardView_weathy_radius, 35.dpFloat)
            shadowColor = arr.getColor(R.styleable.WeathyCardView_weathy_shadow_color, defaultShadowColor)
            disableShadow = arr.getBoolean(R.styleable.WeathyCardView_weathy_disable_shadow, false)
            strokeColor = arr.getColor(R.styleable.WeathyCardView_weathy_stroke_color, Color.TRANSPARENT)
            strokeWidth = arr.getDimension(R.styleable.WeathyCardView_weathy_stroke_width, 0f)
            cardBackgroundColor = arr.getColor(R.styleable.WeathyCardView_weathy_background_color, Color.WHITE)
        }
    }

    private fun updateUI() {
        background = MaterialShapeDrawable(ShapeAppearanceModel().withCornerSize(radius)).apply {
            fillColor = ColorStateList.valueOf(cardBackgroundColor)
            strokeWidth = this@WeathyCardView.strokeWidth
            strokeColor = ColorStateList.valueOf(this@WeathyCardView.strokeColor)
        }
        setShadowColorIfAvailable(shadowColor)
    }
}
```

```xml
<team.weathy.view.calendar.CalendarView
    curDate="@={vm.curDate}"
    android:id="@+id/calendarView"
    android:layout_width="match_parent"
    android:layout_height="220dp"
    app:layout_constraintTop_toTopOf="parent" />
```

- ìº˜ë¦°ë” ë·°(`CalendarView`)
***CalendarView.kt***
```kotlin
class CalendarView @JvmOverloads constructor(context: Context, attrs: AttributeSet? = null) :
    ConstraintLayout(context, attrs) {
    private val today = LocalDate.now()

    var onDateChangeListener: ((date: LocalDate) -> Unit)? = null
    var onSelectedDateChangeListener: ((date: LocalDate) -> Unit)? = null

    private val curDateLiveData = MutableLiveData(LocalDate.now())
    var curDate: LocalDate by OnChangeProp(LocalDate.now()) {
         onCurDateChanged()
    }

    private val selectedDateLiveData = MutableLiveData(LocalDate.now())
    var selectedDate: LocalDate by OnChangeProp(LocalDate.now()) {
        selectedDateLiveData.value = it
        onSelectedDateChangeListener?.invoke(it)
        curDate = it
        invalidate()
    }
    private var rowCount = 4

    private val dataLiveData = MutableLiveData<Map<YearMonthFormat, List<CalendarPreview?>>>(mapOf())
    var data: Map<YearMonthFormat, List<CalendarPreview?>> by OnChangeProp(mapOf()) {
        dataLiveData.value = it
    }

    var onClickYearMonthText: (() -> Unit)? = null

    private val isTodayInCurrentMonth
        get() = curDate.year == today.year && curDate.month == today.month
    private val isTodayInCurrentWeek
        get() = isTodayInCurrentMonth && curDate.weekOfMonth == today.weekOfMonth
    private val isSelectedInCurrentWeek
        get() = selectedDate.year == curDate.year && selectedDate.month == curDate.month && selectedDate.weekOfMonth == curDate.weekOfMonth


    private val animLiveData = MutableLiveData(0f)
    private var animValue by OnChangeProp(0f) {
        animLiveData.value = it
        onAnimValueChanged()
    }

    private val scrollEnabled = MutableLiveData(false)
    private val onScrollToTop = SimpleEventLiveData()

    private val collapsedHeight
        get() = px(MIN_HEIGHT_DP)
    private val expandedHeight
        get() = screenHeight - px(EXPAND_MARGIN_BOTTOM_DP)

    private val paddingHorizontal = px(24)

    private val yearMonthText = TextView(context).apply {
        id = ViewCompat.generateViewId()
        setTextSize(TypedValue.COMPLEX_UNIT_DIP, 25f)
        if (!isInEditMode) typeface = ResourcesCompat.getFont(context, R.font.roboto_medium)
        setTextColor(getColor(R.color.main_grey))
        gravity = Gravity.CENTER
        stateListAnimator = AnimatorInflater.loadStateListAnimator(context, R.animator.pressed_alpha_state_list_anim)

        layoutParams = LayoutParams(WRAP_CONTENT, WRAP_CONTENT).apply {
            topToTop = parentId
            leftToLeft = parentId
            rightToRight = parentId
            topMargin = px(26)
        }
        setOnDebounceClickListener {
            onClickYearMonthText?.invoke()
        }
    }

    private val downArrow = ImageView(context).apply {
        id = ViewCompat.generateViewId()
        setImageResource(R.drawable.calendar_btn_arrow)
        scaleType = FIT_CENTER
        layoutParams = LayoutParams(WRAP_CONTENT, WRAP_CONTENT).apply {
            topToTop = yearMonthText.id
            bottomToBottom = yearMonthText.id
            leftToRight = yearMonthText.id
            leftMargin = 4.dp
        }
    }

    private val todayButton = ImageButton(context).apply {
        setImageResource(R.drawable.ic_today)
        scaleType = FIT_CENTER

        val outValue = TypedValue()
        context.theme.resolveAttribute(attr.selectableItemBackgroundBorderless, outValue, true)
        setBackgroundResource(outValue.resourceId)

        setOnDebounceClickListener {
            curDate = today
            selectedDate = today
        }

        layoutParams = LayoutParams(px(32), px(32)).apply {
            setPadding(px(6), px(6), px(6), px(6))
            topToTop = yearMonthText.id
            bottomToBottom = yearMonthText.id
            rightToRight = parentId
            rightMargin = px(0)
        }
    }

    private val topDivider = View(context).apply {
        id = ViewCompat.generateViewId()
        setBackgroundColor(getColor(R.color.sub_grey_5))

        layoutParams = LayoutParams(MATCH_PARENT, px(1)).apply {
            topToBottom = yearMonthText.id
            topMargin = px(11)
        }
    }

    private val weekTextLayout = LinearLayout(context).apply {
        id = ViewCompat.generateViewId()
        orientation = LinearLayout.HORIZONTAL
        weightSum = 7f

        layoutParams = LayoutParams(MATCH_PARENT, WRAP_CONTENT).apply {
            topToBottom = topDivider.id
            topMargin = px(16)
        }
    }
    private val weekTexts = (0..6).map {
        TextView(context).apply {
            id = ViewCompat.generateViewId()
            setTextSize(TypedValue.COMPLEX_UNIT_DIP, 13f)
            text = listOf("ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† ")[it]
            gravity = Gravity.CENTER

            layoutParams = LinearLayout.LayoutParams(MATCH_PARENT, WRAP_CONTENT, 1f)
        }
    }

    private var isExpanded = false
    private fun expand() {
        isExpanded = true
        notifyEnableScroll()
        enableTouchMonthlyPagerOnly()

        springAnim = AnimUtil.runSpringAnimation(animValue * 500f, 500f) {
            animValue = it / 500f
        }

        onExpandedChange()
    }

    private fun collapse() {
        isExpanded = false
        notifyDisableScroll()
        enableTouchWeeklyPagerOnly()

        springAnim = AnimUtil.runSpringAnimation(animValue * 500f, 0f) {
            animValue = it / 500f
        }

        onExpandedChange()
    }

    private fun onExpandedChange() {
        notifyScrollToTop()
        invalidate()
    }

    private val fragmentViewLifecycleOwner
        get() = findFragment<Fragment>().viewLifecycleOwner

    private val monthlyViewPagerGenerator = {
        ViewPager2(context).apply {
            layoutParams = LayoutParams(MATCH_PARENT, 0).apply {
                topToBottom = weekTextLayout.id
                bottomToBottom = parentId
                bottomMargin = px(32)
            }

            adapter = MonthlyAdapter(
                animLiveData,
                scrollEnabled,
                onScrollToTop,
                dataLiveData,
                selectedDateLiveData,
                fragmentViewLifecycleOwner,
            ) {
                if (!it.isFuture()) selectedDate = it
            }
            setCurrentItem(MonthlyAdapter.MAX_ITEM_COUNT, false)
            alpha = 0f

            setPageTransformer { page, position ->
                page.pivotX = if (position < 0) page.width.toFloat() else 0f
                page.pivotY = page.height * 0.5f
                page.rotationY = 25f * position
            }

            registerOnPageChangeCallback(object : OnPageChangeCallback() {
                override fun onPageSelected(position: Int) {
                    val (_, firstDateOfMonth) = convertMonthlyIndexToDateToFirstDateOfMonthCalendar(
                        position
                    )
                    if (isExpanded && curDate != firstDateOfMonth) {
                        curDate = firstDateOfMonth
                    }
                }
            })

            offscreenPageLimit = 1
        }
    }
    private var monthlyViewPager: ViewPager2? = null
    private val weeklyViewPagerGenerator = {
        ViewPager2(context).apply {
            layoutParams = LayoutParams(MATCH_PARENT, 0).apply {
                topToBottom = weekTextLayout.id
                height = px(WeeklyView.ITEM_HEIGHT_DP)
            }

            adapter = WeeklyAdapter(animLiveData, dataLiveData, fragmentViewLifecycleOwner) {
                if (!it.isFuture()) selectedDate = it
            }
            setCurrentItem(WeeklyAdapter.MAX_ITEM_COUNT, false)

            setPageTransformer { page, position ->
                page.pivotX = if (position < 0) page.width.toFloat() else 0f
                page.pivotY = page.height * 0.5f
                page.rotationY = 40f * position
            }

            registerOnPageChangeCallback(object : OnPageChangeCallback() {
                override fun onPageSelected(position: Int) {
                    val newDate = convertWeeklyIndexToFirstDateOfWeekCalendar(position)
                    if (!isExpanded && curDate != newDate) {
                        curDate = newDate
                    }
                }
            })

            offscreenPageLimit = 1
        }
    }
    private var weeklyViewPager: ViewPager2? = null

    init {
        initContainer()
        addViews()
        configureExpandGestureHandling()
        enableTouchWeeklyPagerOnly()
        changeWeekTextsColor()
        onCurDateChanged()
    }


    private val scope = CoroutineScope(Job() + Dispatchers.Main)
    private lateinit var lazyPagerAddJob: Job
    override fun onAttachedToWindow() {
        super.onAttachedToWindow()
        lazyPagerAddJob = scope.launch {
            if (weeklyViewPager == null) {
                weeklyViewPager = weeklyViewPagerGenerator()
                TransitionManager.beginDelayedTransition(this@CalendarView)
                addView(weeklyViewPager!!, 0)
            }
            delay(400)
            if (monthlyViewPager == null) {
                monthlyViewPager = monthlyViewPagerGenerator()
                addView(monthlyViewPager!!, 0)
            }
        }
    }

    override fun onDetachedFromWindow() {
        super.onDetachedFromWindow()
        lazyPagerAddJob.cancel()
    }

    private fun initContainer() {
        setPadding(paddingHorizontal, 0, paddingHorizontal, 0)

        background = MaterialShapeDrawable(
            ShapeAppearanceModel().toBuilder().setBottomLeftCorner(CornerFamily.ROUNDED, px(35).toFloat())
                .setBottomRightCorner(CornerFamily.ROUNDED, px(35).toFloat()).build()
        ).apply {
            fillColor = ColorStateList.valueOf(getColor(R.color.white))
        }
        elevation = px(4).toFloat()
    }

    private fun addViews() {
        addView(yearMonthText)
        addView(downArrow)
        addView(todayButton)
        addView(topDivider)
        addWeekLayoutAndWeekTexts()
    }

    private fun addWeekLayoutAndWeekTexts() = weekTextLayout.also { layout ->
        addView(layout)
        weekTexts.forEach(layout::addView)
    }

    private fun onCurDateChanged() {
        curDateLiveData.value = curDate
        rowCount = calculateRequiredRow(curDate)

        setYearMonthTextWithDate(curDate)
        selectPagerItemsWithDate(curDate)

        onDateChangeListener?.invoke(curDate)
        changeWeekTextsColor()
        notifyScrollToTop()
        invalidate()
    }

    private fun setYearMonthTextWithDate(date: LocalDate) {
        yearMonthText.text = "${date.year} .${date.monthValue}"
    }

    private fun selectPagerItemsWithDate(date: LocalDate) {
        val nextMonthlyIndex = convertDateToMonthlyIndex(date)
        val nextWeeklyIndex = convertDateToWeeklyIndex(date)

        if (monthlyViewPager?.currentItem != nextMonthlyIndex) {
            monthlyViewPager?.setCurrentItem(
                nextMonthlyIndex, false
            )
        }

        if (weeklyViewPager?.currentItem != nextWeeklyIndex) {
            weeklyViewPager?.setCurrentItem(
                nextWeeklyIndex, false
            )
        }
    }


    private val barPaint = Paint(Paint.ANTI_ALIAS_FLAG).apply {
        color = getColor(R.color.main_mint)
    }
    private val greyCapsulePaint = Paint(Paint.ANTI_ALIAS_FLAG).apply {
        color = getColor(R.color.sub_grey_5)
        setShadowLayer(12f, 0f, 0f, getColor(R.color.sub_grey_5))
    }
    private val capsulePaint = Paint(Paint.ANTI_ALIAS_FLAG).apply {
        color = getColor(R.color.main_mint)
        setShadowLayer(12f, 0f, 0f, getColor(R.color.main_mint))
    }

    override fun onDraw(canvas: Canvas) {
        // bar
        canvas.drawRoundRect(
            width / 2f - px(30),
            height - pxFloat(16),
            width / 2f + px(30),
            height - pxFloat(11),
            pxFloat(10),
            pxFloat(10),
            barPaint,
        )

        // capsule
        val widthWithoutPadding = width - paddingHorizontal * 2f
        val rawWidth = widthWithoutPadding / 7f
        val maxWidth = pxFloat(42)
        val capsuleWidth = rawWidth.coerceAtMost(maxWidth)
        val capsuleLeftPadding = if (rawWidth >= maxWidth) (rawWidth - maxWidth) / 2f else 0f
        val capsuleHeight = pxFloat(64)
        val capsuleLeft = paddingHorizontal + capsuleLeftPadding + today.dayOfWeekIndex * rawWidth
        val capsuleWidthRadius = capsuleWidth / 2f
        val capsuleTop = pxFloat(72)

        val greyCapsuleLeft = paddingHorizontal + capsuleLeftPadding + selectedDate.dayOfWeekIndex * rawWidth
        if (isSelectedInCurrentWeek) {
            canvas.drawRoundRect(
                greyCapsuleLeft,
                capsuleTop,
                greyCapsuleLeft + capsuleWidth,
                capsuleTop + capsuleHeight,
                capsuleWidthRadius,
                capsuleWidthRadius,
                greyCapsulePaint
            )
        }

        if (isTodayInCurrentWeek) {
            canvas.drawRoundRect(
                capsuleLeft,
                capsuleTop,
                capsuleLeft + capsuleWidth,
                capsuleTop + capsuleHeight,
                capsuleWidthRadius,
                capsuleWidthRadius,
                capsulePaint,
            )
        }
    }

    private var springAnim: SpringAnimation? = null
    private var tracker: VelocityTracker? = null

    @SuppressLint("Recycle")
    private fun configureExpandGestureHandling() {
        setOnTouchListener { view, event ->
            when (event.actionMasked) {
                MotionEvent.ACTION_DOWN -> {
                    if (event.y <= view.height - px(30)) {
                        return@setOnTouchListener false
                    }

                    springAnim?.cancel()

                    tracker?.clear()
                    tracker = tracker ?: VelocityTracker.obtain()
                    tracker?.addMovement(event)
                }
                MotionEvent.ACTION_MOVE -> {
                    tracker?.apply {
                        addMovement(event)
                        computeCurrentVelocity(1000)
                    }

                    animValue = ((event.y - collapsedHeight) / (expandedHeight - collapsedHeight)).clamp(0f, 1.2f)
                }
                MotionEvent.ACTION_UP, MotionEvent.ACTION_CANCEL -> {
                    if (tracker!!.yVelocity > 0) expand()
                    else collapse()

                    tracker?.also {
                        it.recycle()
                        tracker = null
                    }
                }
            }
            true
        }
    }

    private fun onAnimValueChanged() {
        animateHeight()
        changeWeekTextsColor()
        animCapsulePaintAlpha()
        animPagersAlpha()
    }

    private fun animateHeight() = updateLayoutParams<ViewGroup.LayoutParams> {
        height = MathUtils.lerp(collapsedHeight.toFloat(), expandedHeight.toFloat(), animValue).toInt()
    }

    private fun changeWeekTextsColor() {
        weekTexts.forEachIndexed { idx, textView ->
            textView.setTextColor(
                CalendarUtil.getWeekTextColor(
                    context, idx, animValue, isTodayInCurrentWeek && today.dayOfWeekIndex == idx
                )
            )
        }
    }


    private fun animCapsulePaintAlpha() {
        capsulePaint.alpha = (255 - animValue * 255).toInt().clamp(0, 255)
        greyCapsulePaint.alpha = (255 - animValue * 255).toInt().clamp(0, 255)
    }

    private fun animPagersAlpha() {
        weeklyViewPager?.alpha = 1 - animValue
        monthlyViewPager?.alpha = animValue
    }

    private fun notifyDisableScroll() {
        scrollEnabled.value = false
    }

    private fun notifyEnableScroll() {
        scrollEnabled.value = true
    }

    private fun notifyScrollToTop() {
        onScrollToTop.emit()
    }

    private fun enableTouchWeeklyPagerOnly() {
        weeklyViewPager?.isUserInputEnabled = true
        monthlyViewPager?.isUserInputEnabled = false

        if (weeklyViewPager != null && monthlyViewPager != null) {
            removeViewAt(0)
            removeViewAt(0)
            addView(monthlyViewPager, 0)
            addView(weeklyViewPager, 1)
        }
    }

    private fun enableTouchMonthlyPagerOnly() {
        weeklyViewPager?.isUserInputEnabled = false
        monthlyViewPager?.isUserInputEnabled = true

        if (weeklyViewPager != null && monthlyViewPager != null) {
            removeViewAt(0)
            removeViewAt(0)
            addView(weeklyViewPager, 0)
            addView(monthlyViewPager, 1)
        }
    }

    companion object {
        private const val parentId = ConstraintSet.PARENT_ID
        private const val MIN_HEIGHT_DP = 224
        private const val EXPAND_MARGIN_BOTTOM_DP = 120
    }
}
```

- ë‚ ì§œ ê³„ì‚° ìœ í‹¸ë¦¬í‹°
***DateTime.kt***
```kotlin
fun convertMonthlyIndexToDateToFirstDateOfMonthCalendar(index: Int): Pair<LocalDate, LocalDate> {
    val cur = LocalDate.now()

    val diffMonth = MonthlyAdapter.MAX_ITEM_COUNT - index - 1
    val monthSubtracted = cur.minusMonths(diffMonth.toLong())
    val firstDateOfMonth = monthSubtracted.withDayOfMonth(1)
    val startIdx = firstDateOfMonth.dayOfWeekIndex

    return firstDateOfMonth.minusDays(startIdx.toLong()) to firstDateOfMonth
}

fun convertWeeklyIndexToFirstDateOfWeekCalendar(index: Int): LocalDate {
    val cur = LocalDate.now()

    val diffWeek = WeeklyAdapter.MAX_ITEM_COUNT - index - 1
    val weekSubtracted = cur.minusWeeks(diffWeek.toLong())
    val startIdx = weekSubtracted.dayOfWeekIndex

    return weekSubtracted.minusDays(startIdx.toLong())
}

fun convertDateToMonthlyIndex(date: LocalDate): Int {
    val now = LocalDate.now()

    val yearDiff = now.year - date.year
    val diffIndex = now.monthValue - date.monthValue + yearDiff * 12

    return MonthlyAdapter.MAX_ITEM_COUNT - diffIndex - 1
}

fun convertDateToWeeklyIndex(date: LocalDate): Int {
    val now = LocalDate.now()
    val nowDayOfWeekIndex = now.dayOfWeekIndex
    val nowFirstDayOfWeek = now.minusDays(nowDayOfWeekIndex.toLong())

    val dateDayOfWeekIndex = date.dayOfWeekIndex
    val dateFirstDayOfWeek = date.minusDays(dateDayOfWeekIndex.toLong())

    val weekDiff = dateFirstDayOfWeek.until(nowFirstDayOfWeek, ChronoUnit.WEEKS).toInt()

    return WeeklyAdapter.MAX_ITEM_COUNT - weekDiff - 1
}


fun calculateRequiredRow(date: LocalDate): Int {
    return (date.lengthOfMonth() + date.withDayOfMonth(1).dayOfWeekIndex - 1) / 7 + 1
}

fun getStartDateStringInCalendar(year: Int, month: Int): DateString {
    val date = LocalDate.of(year, month, 1)
    val startDayIndex = date.dayOfWeekIndex

    val startDateInCalendar = date.minusDays(startDayIndex.toLong())
    return startDateInCalendar.dateString
}

fun getEndDateStringInCalendar(year: Int, month: Int): DateString {
    val firstDate = LocalDate.of(year, month, 1)
    val lastDate = LocalDate.of(year, month, firstDate.lengthOfMonth())
    val endDayIndex = lastDate.dayOfWeekIndex

    val endDateInCalendar = lastDate.plusDays(6 - endDayIndex.toLong())
    return endDateInCalendar.dateString
}
```

- ê¶Œí•œ í—ˆìš© ìœ í‹¸ë¦¬í‹°
***PermissionUtil.kt***
```kotlin
/**
 * Dexterë¥¼ ì´ìš©í•œ ê¶Œí•œ ìš”ì²­ ë° ì½œë°±ì— ê´€ë ¨ëœ ìœ í‹¸
 *
 * @author MJStudio
 * @see android.Manifest.permission
 */
object PermissionUtil {
    fun requestLocationPermissions(activity: Activity, listener: PermissionListener) {
        requestPermissions(
            activity, listOf(
                android.Manifest.permission.ACCESS_COARSE_LOCATION,
                android.Manifest.permission.ACCESS_FINE_LOCATION,
            ), listener
        )
    }

    /**
     * ê¶Œí•œë“¤ì´ í—ˆìš©ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬ë¥¼ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜
     *
     * @param activity Dexter ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì‚¬ìš©í•  Activity ê°ì²´
     * @param listener ê¶Œí•œë“¤ì— ëŒ€í•œ ê²€ì‚¬ê°€ ì™„ë£Œë˜ì—ˆì„ ë•Œ ì½œë°±ì„ ì²˜ë¦¬í•  ë¦¬ìŠ¤ë„ˆ
     * @param permissions ìš”ì²­í•˜ëŠ” ê¶Œí•œ ëª©ë¡ [android.Manifest.permission]
     */
    private fun requestPermissions(activity: Activity, permissions: Collection<String>, listener: PermissionListener) {

        val callbackListener: MultiplePermissionsListener = object : BaseMultiplePermissionsListener() {

            override fun onPermissionsChecked(report: MultiplePermissionsReport) {

                val deniedPermissions = report.deniedPermissionResponses.map { it.permissionName }
                val permanentlyDeniedPermissions =
                    report.deniedPermissionResponses.filter { it.isPermanentlyDenied }.map { it.permissionName }

                // ëª¨ë“  ê¶Œí•œì´ í—ˆê°€ë˜ì—ˆë‹¤ë©´,
                when {
                    report.areAllPermissionsGranted() -> {
                        listener.onPermissionGranted()
                    }
                    // ê¶Œí•œ ì¤‘ì— ì˜êµ¬ì ìœ¼ë¡œ ê±°ë¶€ëœ ê¶Œí•œì´ ìˆë‹¤ë©´
                    report.isAnyPermissionPermanentlyDenied -> {
                        listener.onAnyPermissionsPermanentlyDeined(deniedPermissions, permanentlyDeniedPermissions)
                    }
                    // ê¶Œí•œ ì¤‘ì— ê±°ë¶€ëœ ê¶Œí•œì´ ìˆë‹¤ë©´
                    else -> {
                        listener.onPermissionShouldBeGranted(deniedPermissions)
                    }
                }
            }

        }

        /**
         * Dexterë¡œ activityë¥¼ ì´ìš©í•œ ê¶Œí•œ ìš”ì²­
         */
        Dexter.withActivity(activity).withPermissions(permissions).withListener(callbackListener).check()
    }


    fun openPermissionSettings(context: Context) {
        context.startActivity(Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS).apply {
            data = Uri.fromParts("package", context.packageName, null)
        })
    }

    interface PermissionListener {
        /**
         * ëª¨ë“  ê¶Œí•œì´ í—ˆìš©ë˜ì—ˆë‹¤.
         */
        fun onPermissionGranted() {}

        /**
         * ì¼ë¶€ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆë‹¤.
         *
         * @param deniedPermissions ê±°ë¶€ëœ ê¶Œí•œ ëª©ë¡
         */
        fun onPermissionShouldBeGranted(deniedPermissions: List<String>) {}

        /**
         * ì¼ë¶€ ê¶Œí•œì´ ì˜êµ¬ì ìœ¼ë¡œ ê±°ë¶€ë˜ì—ˆë‹¤.
         *
         * @param deniedPermissions ê±°ë¶€ëœ ê¶Œí•œ ëª©ë¡
         * @param permanentDeniedPermissions ì˜êµ¬ì ìœ¼ë¡œ ê±°ë¶€ëœ ê¶Œí•œ ëª©ë¡
         */
        fun onAnyPermissionsPermanentlyDeined(
            deniedPermissions: List<String>, permanentDeniedPermissions: List<String>
        ) {
        }
    }
}
```

- StatusBar ìƒíƒœ ì¡°ì ˆ ìœ í‹¸ë¦¬í‹°
***StatusBarUtil.kt***
```kotlin
@Suppress("DEPRECATION")
object StatusBarUtil {
    fun changeColor(activity: Activity, @ColorInt color: Int) {
        activity.window?.run {
            statusBarColor = color
        }
    }
}
```

- Dagger mock api module
***ApiModule.kt***
```kotlin
@Qualifier
@Retention(BINARY)
annotation class Api

@Qualifier
@Retention(BINARY)
annotation class ApiMock

@Module
@InstallIn(ApplicationComponent::class)
class ApiModule {
    @Provides
    @Singleton
    fun provideRetrofitProvider(uniqueId: UniqueIdentifier) = ApiFactory(uniqueId)

    @Provides
    @Singleton
    @Api
    fun provideAuth(provider: ApiFactory) = provider.createApi(AuthAPI::class)

    @Provides
    @Singleton
    @Api
    fun provideCalendar(provider: ApiFactory) = provider.createApi(CalendarAPI::class)

    @Provides
    @Singleton
    @Api
    fun provideClothes(provider: ApiFactory) = provider.createApi(ClothesAPI::class)

    @Provides
    @Singleton
    @Api
    fun provideUser(provider: ApiFactory) = provider.createApi(UserAPI::class)

    @Provides
    @Singleton
    @Api
    fun provideWeather(provider: ApiFactory) = provider.createApi(WeatherAPI::class)

    @Provides
    @Singleton
    @Api
    fun provideWeahy(provider: ApiFactory) = provider.createApi(WeathyAPI::class)
}

@Module
@InstallIn(ApplicationComponent::class)
abstract class ApiModuleMock {
    @Singleton
    @Binds
    @ApiMock
    abstract fun bindUser(api: MockUserAPI): UserAPI

    @Singleton
    @Binds
    @ApiMock
    abstract fun bindCalendar(api: MockCalendarAPI): CalendarAPI

    @Singleton
    @Binds
    @ApiMock
    abstract fun bindWeather(api: MockWeatherAPI): WeatherAPI

    @Singleton
    @Binds
    @ApiMock
    abstract fun bindWeathy(api: MockWeathyAPI): WeathyAPI
}
```

- CommonDialog ê³µí†µëœ ë‹¤ì´ì–¼ë¡œê·¸ `DialogFragment`
```kotlin
@AndroidEntryPoint
class CommonDialog : DialogFragment() {
    private var binding by AutoClearedValue<DialogCommonBinding>()

    @Inject
    lateinit var pixelRatio: PixelRatio

    private val title: String
        get() = arguments?.getString("title") ?: ""
    private val body: String
        get() = arguments?.getString("body") ?: ""
    private val btnText: String
        get() = arguments?.getString("btnText") ?: ""
    private val color: Int
        get() = arguments?.getInt("color", getColor(R.color.blue_temp)) ?: getColor(R.color.blue_temp)
    private val showCancel: Boolean
        get() = arguments?.getBoolean("showCancel") ?: false
    private val clickListener: ClickListener?
        get() = if (parentFragment == null) (activity as? ClickListener) else (parentFragment as? ClickListener)

    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?) =
        DialogCommonBinding.inflate(inflater, container, false).also {
            binding = it
        }.root

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        isCancelable = false
        binding.title.text = title
        binding.body.text = body
        binding.btn.text = btnText
        binding.btn setOnDebounceClickListener {
            clickListener?.onClickYes()
            dismiss()
        }
        binding.title.setTextColor(color)
        binding.btn.backgroundTintList = ColorStateList.valueOf(color)

        if (showCancel) {
            binding.btn.updateLayoutParams<ConstraintLayout.LayoutParams> {
                leftMargin = 13.dp
            }
            binding.btnCancel.isVisible = true
            binding.btnCancel setOnDebounceClickListener {
                clickListener?.onClickNo()
                dismiss()
            }
        }
    }

    override fun onResume() {
        super.onResume()

        val width = (pixelRatio.screenShort * 0.88f).coerceAtMost(pixelRatio.toPixel(309).toFloat())
        dialog?.window?.run {
            setBackgroundDrawable(ColorDrawable(Color.TRANSPARENT))
            setDimAmount(0.2f)
            setLayout(width.roundToInt(), WRAP_CONTENT)
        }
    }

    interface ClickListener {
        fun onClickYes() {}
        fun onClickNo() {}
    }

    companion object {
        fun newInstance(
            title: String? = null,
            body: String? = null,
            btnText: String? = null,
            color: Int? = null,
            showCancel: Boolean = false
        ) = CommonDialog().apply {
            arguments = bundleOf(
                "title" to title, "body" to body, "btnText" to btnText, "color" to color, "showCancel" to showCancel
            )
        }
    }
}
```

- EventLiveData
```kotlin
typealias SimpleEventLiveData = EventLiveData<Unit>
## íŠ¹ìˆ˜ ë ˆì´ì•„ì›ƒ

class EventLiveData<T> : LiveData<T>() {
    private val pending = AtomicBoolean(false)

    override fun observe(owner: LifecycleOwner, observer: Observer<in T>) {
        super.observe(owner) {
            if (pending.compareAndSet(true, false)) {
                observer.onChanged(it)
            }
        }
    }

    @MainThread
    fun emit(value: T) {
        pending.set(true)
        setValue(value)
    }
}

fun SimpleEventLiveData.emit() {
    emit(Unit)
}
```

- AppEvent

```kotlin
fun SimpleSharedFlow() = MutableSharedFlow<Unit>(1, 0, DROP_OLDEST)
fun MutableSharedFlow<Unit>.emit() = tryEmit(Unit)

object AppEvent {
    val onWeathyUpdated = SimpleSharedFlow()
}
```

## íŠ¹ìˆ˜ ë ˆì´ì•„ì›ƒ

- `WeathyCardView.kt` ê°™ì€ ê³³ì—ì„œ ë‹¨ìˆœí•˜ê²Œ frameì— í‘œí˜„í•  ìˆ˜ ìˆì„ ë•Œ `FrameLayout` ì‚¬ìš© [ë§í¬](https://github.com/TeamWeathy/WeathyAndroid/blob/main/app/src/main/java/team/weathy/view/WeathyCardView.kt)

- `fragment_home.xml` ì—ì„œ MotionLayout ì‚¬ìš© (ë©”ì¸ ì• ë‹ˆë©”ì´ì…˜ êµ¬í˜„ ìœ„í•¨) 

[ë§í¬](https://github.com/TeamWeathy/WeathyAndroid/blob/main/app/src/main/res/layout/fragment_home.xml)

[ëª¨ì…˜íŒŒì¼ ë§í¬](https://github.com/TeamWeathy/WeathyAndroid/blob/main/app/src/main/res/xml/home_motion.xml)

```xml
 <androidx.constraintlayout.motion.widget.MotionLayout
            android:id="@+id/container"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:clipChildren="false"
            android:clipToPadding="false"
            app:layoutDescription="@xml/home_motion">

            <androidx.constraintlayout.widget.Guideline
                android:id="@+id/guide_left"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                app:layout_constraintGuide_begin="26dp" />

            <androidx.constraintlayout.widget.Guideline
                android:id="@+id/guide_right"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                app:layout_constraintGuide_end="26dp" />

            <ImageView
                android:id="@+id/topBlur"
                android:layout_width="match_parent"
                android:layout_height="78dp"
                android:elevation="9dp"
                android:outlineProvider="none"
                android:scaleType="fitXY"
                srcResource="@{vm.weatherSecondBackground}"
                app:layout_constraintTop_toTopOf="parent" />
   ......
```

## ë„í˜• ë° ìƒíƒœë³€í™˜

- `WeathyCardView` ì—ì„œ `MaterialShapeDrawable` ì™€ `ShapeAppearanceModel` ì„ ì‚¬ìš©í•´ì„œ ë‘¥ê·¸ë€ ëª¨ì„œë¦¬ í‘œí˜„ 

[ë§í¬](https://github.com/TeamWeathy/WeathyAndroid/blob/main/app/src/main/java/team/weathy/view/WeathyCardView.kt)

- `fragment_home.xml` ì—ì„œ íŒì—…ì€ ë””ìì´ë„ˆê°€ ì´ë¯¸ì§€ë¡œ ê·¸ëŒ€ë¡œ ì¤¬ê¸° ë•Œë¬¸ì— ê·¸ëŒ€ë¡œ ì´ë¯¸ì§€ë¡œ ì‚¬ìš©

[ë§í¬](https://github.com/TeamWeathy/WeathyAndroid/blob/main/app/src/main/res/layout/fragment_home.xml)

- `activity_developer_info.xml` ì—ì„œ ë°°ê²½ì„ ê·¸ëƒ¥ ì´ë¯¸ì§€ë¡œ ì²˜ë¦¬

[ë§í¬](https://github.com/TeamWeathy/WeathyAndroid/blob/main/app/src/main/res/layout/activity_developer_info.xml)
